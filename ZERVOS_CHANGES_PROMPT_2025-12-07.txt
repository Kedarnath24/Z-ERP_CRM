# Zervos System Enhancement Prompt - December 7, 2025

## Overview
Enhance the Zervos appointment booking system to show service/product suggestions and fix service loading issues. Also create comprehensive reporting templates.

## Changes Required

### 1. Update Appointment Service/Product Suggestions

**File:** `frontend/client/src/pages/AppointmentsNew.tsx`

**Location:** Service Selection section (around line 1830-1900)

**Change:** Replace the service dropdown to show both services and products categorized:

```typescript
// OLD CODE:
<Label>Service *</Label>
<Select
  value={isCustomService ? 'custom' : newAppointment.serviceName || undefined}
  onValueChange={(v) => {
    if (v === 'custom') {
      setIsCustomService(true);
      setNewAppointment({ ...newAppointment, serviceName: '' });
    } else {
      setIsCustomService(false);
      const nextValue = v.trim();
      setNewAppointment({ ...newAppointment, serviceName: nextValue, customService: '' });
    }
  }}
>
  <SelectTrigger>
    <SelectValue placeholder="Select service" />
  </SelectTrigger>
  <SelectContent>
    {serviceOptions.length > 0 ? (
      serviceOptions.map((service) => (
        <SelectItem key={service.id} value={service.name}>
          {service.name} {service.currency === 'INR' ? `- ₹${service.price}` : `- ${service.currency}${service.price}`}
        </SelectItem>
      ))
    ) : (
      <SelectItem value="no-services-available" disabled>No services available</SelectItem>
    )}
    <SelectItem value="custom">✏️ Custom Service</SelectItem>
  </SelectContent>
</Select>

// NEW CODE:
<Label>Service / Product *</Label>
<Select
  value={isCustomService ? 'custom' : newAppointment.serviceName || undefined}
  onValueChange={(v) => {
    if (v === 'custom') {
      setIsCustomService(true);
      setNewAppointment({ ...newAppointment, serviceName: '' });
    } else {
      setIsCustomService(false);
      const nextValue = v.trim();
      setNewAppointment({ ...newAppointment, serviceName: nextValue, customService: '' });
    }
  }}
>
  <SelectTrigger>
    <SelectValue placeholder="Select service or product" />
  </SelectTrigger>
  <SelectContent className="max-h-[300px]">
    {serviceOptions.length > 0 && (
      <>
        <div className="px-2 py-1.5 text-xs font-semibold text-muted-foreground bg-muted/50">Services</div>
        {serviceOptions.map((service) => (
          <SelectItem key={`service-${service.id}`} value={service.name}>
            {service.name} {service.currency === 'INR' ? `- ₹${service.price}` : `- ${service.currency}${service.price}`}
          </SelectItem>
        ))}
      </>
    )}
    {productOptions.length > 0 && (
      <>
        <div className="px-2 py-1.5 text-xs font-semibold text-muted-foreground bg-muted/50 mt-1">Products</div>
        {productOptions.map((product) => (
          <SelectItem key={`product-${product.id}`} value={product.name}>
            {product.name} {product.currency === 'INR' ? `- ₹${product.price}` : `- ${product.currency || 'INR'}${product.price}`}
          </SelectItem>
        ))}
      </>
    )}
    {serviceOptions.length === 0 && productOptions.length === 0 && (
      <SelectItem value="no-items-available" disabled>No services or products available</SelectItem>
    )}
    <div className="border-t mt-1"></div>
    <SelectItem value="custom">✏️ Custom Service</SelectItem>
  </SelectContent>
</Select>
```

### 2. Fix Service Loading Logic

**File:** `frontend/client/src/pages/AppointmentsNew.tsx`

**Location:** loadServices function (around line 255)

**Change:** Replace the hardcoded service loading with proper localStorage reading:

```typescript
// OLD CODE:
const loadServices = () => {
  try {
    const currentWorkspace = localStorage.getItem('currentWorkspace') || 'default';
    // Force initialize with complete default services
    const defaultServices = [
      // ... long list of hardcoded services
    ];
    localStorage.setItem(`zervos_services_${currentWorkspace}`, JSON.stringify(defaultServices));
    setServices(defaultServices);
  } catch (error) {
    console.error('Error loading services:', error);
  }
};

// NEW CODE:
const loadServices = () => {
  try {
    const currentWorkspace = localStorage.getItem('currentWorkspace') || 'default';
    const stored = localStorage.getItem(`zervos_services_${currentWorkspace}`);
    if (stored) {
      const parsedServices = JSON.parse(stored);
      // Filter only enabled services
      const enabledServices = parsedServices.filter((s: any) => s.isEnabled);
      setServices(enabledServices);
    } else {
      // Only initialize with defaults if no services exist
      const defaultServices = [
        {
          id: 'reflex-45',
          name: 'Foot Reflexology',
          duration: '45 mins',
          price: '1000',
          actualPrice: '1000',
          currency: 'INR',
          description: 'Basic foot reflexology session',
          category: 'Spa & Wellness',
          isEnabled: true,
          createdAt: new Date().toISOString(),
        },
        {
          id: 'reflex-60',
          name: 'Foot Reflexology',
          duration: '60 mins',
          price: '1300',
          actualPrice: '1300',
          currency: 'INR',
          description: 'Extended foot reflexology session',
          category: 'Spa & Wellness',
          isEnabled: true,
          createdAt: new Date().toISOString(),
        },
      ];
      localStorage.setItem(`zervos_services_${currentWorkspace}`, JSON.stringify(defaultServices));
      setServices(defaultServices);
    }
  } catch (error) {
    console.error('Error loading services:', error);
  }
};
```

### 3. Create Daily Business Report Template

**File:** `DAILY_REPORT_[DATE].csv`

**Content:** Create CSV file with this structure:

```csv
"═══════════════════════════════════════════════════════════════"
"              DAILY BUSINESS REPORT - [DATE]"
"═══════════════════════════════════════════════════════════════"
"Generated: [CURRENT_DATE_TIME]"
"Report Period: [REPORT_DATE]"

"━━━ KEY METRICS SUMMARY ━━━"
"Total Appointments",[COUNT]
"Completed Appointments",[COUNT]
"Upcoming Appointments",[COUNT]
"Cancelled Appointments",[COUNT]
"Total Revenue","₹[AMOUNT]"
"Average Transaction Value","₹[AMOUNT]"
"Completion Rate","[PERCENTAGE]%"
"Cancellation Rate","[PERCENTAGE]%"

[Additional sections for appointment breakdown, revenue, staff performance, etc.]
```

### 4. Create Work Report Template

**File:** `DAILY_WORK_REPORT_[DATE].txt`

**Content:** Create text file with this structure:

```text
═══════════════════════════════════════════════════════════════
              DAILY WORK REPORT - [DATE]
═══════════════════════════════════════════════════════════════
Generated: [CURRENT_DATE_TIME]
Report Period: [REPORT_DATE]


1. Today's Accomplishments:
	• [Accomplishment 1]
	• [Accomplishment 2]
	• [Accomplishment 3]


2. Challenges / Blockers:
	• [Challenge 1]
	• [Challenge 2]
	• [Challenge 3]


3. Plan for Tomorrow:
	• [Plan 1]
	• [Plan 2]
	• [Plan 3]


4. Hours Worked Today:
	• [X] hours


═══════════════════════════════════════════════════════════════
Business Metrics Summary:
• Total Appointments: [COUNT]
• Completed: [COUNT]
• Revenue: ₹[AMOUNT]
• New Customers: [COUNT]
═══════════════════════════════════════════════════════════════

Notes:
- [Additional notes and observations]

═══════════════════════════════════════════════════════════════
Report generated by Zervos Business Management System
```

## Testing Instructions

1. **Test Service/Product Suggestions:**
   - Add services in the Services page
   - Add products in the Products page
   - Create new appointment and verify both appear in dropdown

2. **Test Service Loading:**
   - Add/modify services in Services page
   - Refresh appointment page
   - Verify changes reflect immediately

3. **Test Reports:**
   - Generate daily business report
   - Generate work report
   - Verify formatting and data accuracy

## Expected Results

- Appointment booking shows categorized services and products
- Service changes reflect immediately without page refresh
- Reports generate in proper format with accurate data
- System maintains data consistency across all modules

## Files Modified

1. `frontend/client/src/pages/AppointmentsNew.tsx` - Enhanced service/product suggestions and fixed loading logic
2. `DAILY_REPORT_[DATE].csv` - Created business report template
3. `DAILY_WORK_REPORT_[DATE].txt` - Created work report template

## Dependencies

- React/TypeScript environment
- Local storage for data persistence
- CSV/text file generation capabilities
- Proper UI component library (shadcn/ui)

---

**Priority:** High
**Estimated Time:** 2-3 hours
**Testing Required:** Yes
**Documentation Updated:** Yes